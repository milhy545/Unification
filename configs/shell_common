#!/bin/bash
# Unification Shell Common Configuration
# Unified shell configuration for all ecosystem servers

# =============================================================================
# ESSENTIAL ALIASES
# =============================================================================

# System aliases
alias ll='ls -alF'
alias la='ls -A'
alias l='ls -CF'
alias ..='cd ..'
alias ...='cd ../..'
alias ....='cd ../../..'
alias ~='cd ~'
alias -- -='cd -'

# Git aliases
alias gs='git status'
alias ga='git add'
alias gc='git commit'
alias gp='git push'
alias gl='git log --oneline'
alias gd='git diff'
alias gb='git branch'
alias gco='git checkout'

# Development aliases
alias py='python3'
alias pip='pip3'
alias venv='python3 -m venv'
alias activate='source venv/bin/activate'

# System monitoring
alias HAS='htop'
alias LLMS='ps aux | grep -E "(python|node|java)" | grep -v grep'
alias topcpu='ps aux --sort=-%cpu | head -10'
alias topmem='ps aux --sort=-%mem | head -10'

# Tmux ecosystem
alias tmux-new='tmux new-session -d -s'
alias tmux-attach='tmux attach-session -t'
alias tmux-list='tmux list-sessions'
alias tmux-kill='tmux kill-session -t'

# Power management (Q9550 specific)
alias power-status='cat /sys/devices/system/cpu/cpu*/cpufreq/scaling_governor'
alias power-performance='echo performance | sudo tee /sys/devices/system/cpu/cpu*/cpufreq/scaling_governor'
alias power-powersave='echo powersave | sudo tee /sys/devices/system/cpu/cpu*/cpufreq/scaling_governor'
alias power-ondemand='echo ondemand | sudo tee /sys/devices/system/cpu/cpu*/cpufreq/scaling_governor'

# Network utilities
alias myip='curl -s ifconfig.me'
alias localip='ip route get 8.8.8.8 | grep -oP "src \K\S+"'
alias ports='netstat -tuln'
alias connections='ss -tuln'

# =============================================================================
# FUNCTIONS
# =============================================================================

# Create and enter directory
mkcd() {
    mkdir -p "$1" && cd "$1"
}

# Extract various archive formats
extract() {
    if [ -f "$1" ]; then
        case "$1" in
            *.tar.bz2)   tar xjf "$1"     ;;
            *.tar.gz)    tar xzf "$1"     ;;
            *.bz2)       bunzip2 "$1"     ;;
            *.rar)       unrar e "$1"     ;;
            *.gz)        gunzip "$1"      ;;
            *.tar)       tar xf "$1"      ;;
            *.tbz2)      tar xjf "$1"     ;;
            *.tgz)       tar xzf "$1"     ;;
            *.zip)       unzip "$1"       ;;
            *.Z)         uncompress "$1"  ;;
            *.7z)        7z x "$1"        ;;
            *)           echo "'$1' cannot be extracted via extract()" ;;
        esac
    else
        echo "'$1' is not a valid file"
    fi
}

# Find and kill process by name
killp() {
    if [ -z "$1" ]; then
        echo "Usage: killp <process_name>"
        return 1
    fi
    pkill -f "$1"
}

# Quick system info
sysinfo() {
    echo "=== SYSTEM INFORMATION ==="
    echo "Hostname: $(hostname)"
    echo "OS: $(lsb_release -d | cut -f2)"
    echo "Kernel: $(uname -r)"
    echo "Uptime: $(uptime -p)"
    echo "CPU: $(lscpu | grep 'Model name' | cut -d: -f2 | xargs)"
    echo "Memory: $(free -h | grep '^Mem:' | awk '{print $2}')"
    echo "Disk: $(df -h / | tail -1 | awk '{print $2}')"
    echo "Load: $(uptime | awk -F'load average:' '{print $2}')"
}

# Git quick commit
gqc() {
    if [ -z "$1" ]; then
        echo "Usage: gqc <message>"
        return 1
    fi
    git add .
    git commit -m "$1"
}

# Docker shortcuts
dps() { docker ps --format "table {{.Names}}\t{{.Status}}\t{{.Ports}}" }
dpsa() { docker ps -a --format "table {{.Names}}\t{{.Status}}\t{{.Ports}}" }
drm() { docker rm $(docker ps -aq) }
drmi() { docker rmi $(docker images -q) }

# =============================================================================
# ENVIRONMENT VARIABLES
# =============================================================================

# Editor
export EDITOR='nano'
export VISUAL='nano'

# History
export HISTSIZE=10000
export HISTFILESIZE=20000
export HISTCONTROL=ignoreboth

# Path additions
export PATH="$HOME/.local/bin:$PATH"
export PATH="$HOME/.cargo/bin:$PATH"

# Python
export PYTHONPATH="$HOME/Develop:$PYTHONPATH"

# =============================================================================
# PROMPT CUSTOMIZATION
# =============================================================================

# Simple prompt with git branch
parse_git_branch() {
    git branch 2> /dev/null | sed -e '/^[^*]/d' -e 's/* \(.*\)/(\1)/'
}

# Color definitions
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
PURPLE='\033[0;35m'
CYAN='\033[0;36m'
WHITE='\033[1;37m'
NC='\033[0m' # No Color

# Set prompt
if [ "$PS1" ]; then
    PS1="\[${GREEN}\]\u@\h\[${NC}\]:\[${BLUE}\]\w\[${YELLOW}\]\$(parse_git_branch)\[${NC}\]\$ "
fi

# =============================================================================
# WELCOME MESSAGE
# =============================================================================

echo "ðŸš€ Unification Shell Common loaded successfully!"
echo "ðŸ’¡ Available commands: sysinfo, mkcd, extract, killp, gqc, dps, power-*"
echo "ðŸ”§ Tmux: tmux-new, tmux-attach, tmux-list, tmux-kill"
echo "ðŸ“Š Monitoring: HAS, LLMS, topcpu, topmem"